import{j as t}from"./jsx-runtime.ClP7wGfN.js";import{r as o}from"./index.DK-fsZOb.js";import{m as S}from"./proxy.Cdjqwy9W.js";function k(){const e=o.useRef(null),[c,b]=o.useState("disconnected"),[y,g]=o.useState(!1),[l,h]=o.useState(null),u=o.useRef(null);o.useEffect(()=>()=>{e.current&&(e.current.send(JSON.stringify({type:"session.stop"})),e.current.close()),l&&l.getTracks().forEach(s=>s.stop())},[l]);const w=async s=>{const a=atob(s),p=a.length,d=new ArrayBuffer(p),x=new Uint8Array(d);for(let n=0;n<p;n++)x[n]=a.charCodeAt(n);const i=new Int16Array(d),r=new Float32Array(i.length);for(let n=0;n<i.length;n++)r[n]=i[n]/32768;const f=u.current.createBuffer(1,r.length,24e3);f.getChannelData(0).set(r);const m=u.current.createBufferSource();m.buffer=f,m.connect(u.current.destination),m.start()},C=o.useCallback(async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});h(s);const a=new AudioContext({sampleRate:24e3});u.current=a,await a.audioWorklet.addModule("/pcm-processor.js");const p=a.createMediaStreamSource(s),d=new AudioWorkletNode(a,"pcm-processor"),x="wss://ai-lawrence5576ai414338821473.cognitiveservices.azure.com/voice-live/realtime?api-version=2025-05-01-preview&model=gpt-4o-mini-realtime-preview&api-key=8MzlxZIZqiOJryrtTK0ScacHlqKQz8Shl8bdOP9PvnWEJuqbAOWBJQQJ99BDACHYHv6XJ3w3AAAAACOGE7FI";e.current=new WebSocket(x),e.current.binaryType="arraybuffer",e.current.onopen=()=>{b("connected"),console.log("WebSocket connected"),e.current.send(JSON.stringify({type:"session.update",session:{}}))},e.current.onmessage=async i=>{const r=JSON.parse(i.data);r.type==="response.content_part.added"&&r.part?.type==="audio"&&r.part?.data?(await w(r.part.data),g(!0),setTimeout(()=>g(!1),1e3)):console.log("Received from backend:",r)},d.port.onmessage=i=>{const r=new Uint8Array(i.data);if(e.current?.readyState===WebSocket.OPEN){const f=btoa(String.fromCharCode(...r));e.current.send(JSON.stringify({type:"input_audio_buffer.append",audio:f}))}},p.connect(d).connect(a.destination)}catch(s){console.error("Failed to start conversation:",s)}},[]),v=o.useCallback(()=>{e.current&&(e.current.readyState===WebSocket.OPEN&&e.current.send(JSON.stringify({type:"session.stop"})),e.current.close(),b("disconnected")),l&&l.getTracks().forEach(s=>s.stop())},[l]);return t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:C,disabled:c==="connected",className:"px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-300",children:"Start Conversation"}),t.jsx("button",{onClick:v,disabled:c!=="connected",className:"px-4 py-2 bg-red-500 text-white rounded disabled:bg-gray-300",children:"Stop Conversation"})]}),t.jsxs(S.div,{className:"flex flex-col items-center",animate:{scale:[1,1.08,1],boxShadow:["0 0 0px #2563eb","0 0 16px #2563eb","0 0 0px #2563eb"]},transition:{duration:1.5,repeat:1/0,repeatType:"loop"},children:[t.jsxs("p",{className:"text-white",children:["Status: ",c]}),t.jsxs("p",{className:"text-white",children:["Agent is ",y?"speaking":"listening"]})]})]})}function O(){const[e,c]=o.useState(!1);return t.jsxs("div",{className:"fixed bottom-24 right-4 z-50",children:[!e&&t.jsx("button",{onClick:()=>c(!0),className:"bg-primaryColor shadow-xl text-white rounded-full w-16 h-16 flex items-center justify-center text-3xl hover:bg-primaryColorHover transition-all border-4 border-bgDark1","aria-label":"Open voice call widget",children:t.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("circle",{cx:"12",cy:"12",r:"12",fill:"currentColor",opacity:"0.1"}),t.jsx("path",{d:"M7.5 8.5C8.32843 7.67157 9.67157 7.67157 10.5 8.5L11.5 9.5C12.3284 10.3284 12.3284 11.6716 11.5 12.5L11 13C12.5 15 15 17.5 17 19L17.5 18.5C18.3284 17.6716 19.6716 17.6716 20.5 18.5L21.5 19.5C22.3284 20.3284 22.3284 21.6716 21.5 22.5C19.5 24.5 14.5 19.5 12.5 17.5C10.5 15.5 5.5 10.5 7.5 8.5Z",fill:"currentColor"})]})}),e&&t.jsxs("div",{className:"relative bg-bgDark1 border border-primaryColor rounded-2xl shadow-2xl p-6 min-w-[320px] max-w-[90vw]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("span",{className:"font-bold text-primaryColor text-lg",children:"Voice Assistant"}),t.jsx("button",{onClick:()=>c(!1),className:"text-2xl text-primaryColor hover:text-primaryColorHover transition","aria-label":"Close voice call widget",children:"Ã—"})]}),t.jsx(k,{})]})]})}export{O as VoiceWidget};
